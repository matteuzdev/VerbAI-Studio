<div class="h-full flex flex-col bg-[#0B0C10]">
  
  <!-- Topbar -->
  <div class="h-16 bg-[#161821] border-b border-white/5 px-6 flex items-center justify-between shrink-0 shadow-sm">
    <div>
      <h1 class="font-bold text-gray-200 text-lg flex items-center gap-2">
        <span class="material-symbols-outlined text-purple-500">inbox</span>
        {{ store.dict().leads }}
      </h1>
    </div>
    
    <div class="flex items-center gap-2">
        <span class="text-xs text-gray-500 bg-white/5 border border-white/5 px-2 py-1 rounded">
            {{ store.leads().length }} Total
        </span>
        <button (click)="openNewLeadModal()" class="flex items-center gap-2 px-3 py-1.5 bg-purple-600 text-white rounded-lg text-sm font-bold hover:bg-purple-500 transition shadow-[0_0_15px_rgba(147,51,234,0.3)]">
           <span class="material-symbols-outlined text-[18px]">add</span>
           New Lead
        </button>
        <button (click)="exportCsv()" class="flex items-center gap-2 px-3 py-1.5 bg-white/5 border border-white/10 rounded-lg text-sm font-medium hover:bg-white/10 text-gray-300 transition">
           <span class="material-symbols-outlined text-[16px]">download</span>
           Export CSV
        </button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="flex-1 overflow-auto p-6">
    
    <div class="bg-[#1C1D24] rounded-xl border border-white/10 shadow-sm overflow-hidden">
        <table class="w-full text-left border-collapse">
            <thead class="bg-white/5 border-b border-white/5">
                <tr>
                    <th class="py-3 px-6 text-[10px] font-bold text-gray-500 uppercase tracking-wider">Contact</th>
                    <th class="py-3 px-6 text-[10px] font-bold text-gray-500 uppercase tracking-wider">Message/Context</th>
                    <th class="py-3 px-6 text-[10px] font-bold text-gray-500 uppercase tracking-wider">Source</th>
                    <th class="py-3 px-6 text-[10px] font-bold text-gray-500 uppercase tracking-wider">Date</th>
                    <th class="py-3 px-6 text-[10px] font-bold text-gray-500 uppercase tracking-wider">Status</th>
                    <th class="py-3 px-6 text-[10px] font-bold text-gray-500 uppercase tracking-wider text-right">Actions</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-white/5">
                @for (lead of store.leads(); track lead.id) {
                    <tr class="hover:bg-white/5 transition group">
                        <td class="py-4 px-6 cursor-pointer" (click)="editLead(lead)">
                            <p class="font-bold text-gray-200">{{ lead.name }}</p>
                            <p class="text-xs text-gray-500">{{ lead.email }}</p>
                            @if(lead.phone) { <p class="text-xs text-gray-600">{{ lead.phone }}</p> }
                        </td>
                        <td class="py-4 px-6 max-w-xs cursor-pointer" (click)="editLead(lead)">
                            <p class="text-sm text-gray-400 truncate" [title]="lead.message">{{ lead.message || 'No message provided.' }}</p>
                            @if(lead.company) { <p class="text-xs text-purple-400 font-medium mt-1">{{ lead.company }}</p> }
                        </td>
                        <td class="py-4 px-6">
                            <span class="px-2 py-0.5 rounded text-[10px] uppercase font-bold tracking-wide bg-white/5 text-gray-500 border border-white/10">
                                {{ lead.source }}
                            </span>
                        </td>
                        <td class="py-4 px-6 text-sm text-gray-500 whitespace-nowrap">
                            {{ lead.createdAt | date:'shortDate' }}
                            <p class="text-[10px] text-gray-600">{{ lead.createdAt | date:'shortTime' }}</p>
                        </td>
                        <td class="py-4 px-6">
                            <select 
                                [ngModel]="lead.status" 
                                (ngModelChange)="updateStatus(lead.id, $event)"
                                [class]="getStatusColor(lead.status)"
                                class="text-[10px] font-bold px-2 py-1.5 rounded border border-transparent focus:border-purple-500 focus:ring-0 cursor-pointer outline-none appearance-none pr-6 relative block w-full">
                                <option value="new">New</option>
                                <option value="contacted">Contacted</option>
                                <option value="qualified">Qualified</option>
                                <option value="proposal">Proposal</option>
                                <option value="won">Won</option>
                                <option value="lost">Lost</option>
                            </select>
                        </td>
                        <td class="py-4 px-6 text-right">
                            <div class="flex justify-end gap-1">
                                <button (click)="deleteLead(lead.id)" class="text-gray-500 hover:text-red-400 p-2 rounded-full hover:bg-red-500/10 transition" title="Delete Lead">
                                    <span class="material-symbols-outlined text-[18px]">delete</span>
                                </button>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        @if (store.leads().length === 0) {
            <div class="p-12 text-center text-gray-500 flex flex-col items-center">
               <div class="w-16 h-16 bg-white/5 rounded-full flex items-center justify-center mb-4 border border-white/10">
                   <span class="material-symbols-outlined text-3xl">inbox</span>
               </div>
               <p class="font-medium text-gray-400">No leads yet.</p>
               <p class="text-sm">When visitors fill out forms, they will appear here.</p>
            </div>
        }
    </div>

  </div>

  <!-- Create/Edit Modal -->
  @if (isModalOpen()) {
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-[fade-in_0.2s_ease-out]">
        <div class="bg-[#1C1D24] w-full max-w-lg rounded-2xl shadow-2xl p-6 relative border border-white/10">
            <h2 class="text-xl font-bold text-white mb-6">{{ editingLead.id ? 'Edit Lead' : 'Create Lead' }}</h2>
            
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Name *</label>
                        <input type="text" [(ngModel)]="editingLead.name" class="w-full bg-black/30 border border-white/10 rounded p-2 text-sm text-white focus:border-purple-500 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Company</label>
                        <input type="text" [(ngModel)]="editingLead.company" class="w-full bg-black/30 border border-white/10 rounded p-2 text-sm text-white focus:border-purple-500 focus:outline-none">
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Email *</label>
                        <input type="email" [(ngModel)]="editingLead.email" class="w-full bg-black/30 border border-white/10 rounded p-2 text-sm text-white focus:border-purple-500 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Phone</label>
                        <input type="text" [(ngModel)]="editingLead.phone" class="w-full bg-black/30 border border-white/10 rounded p-2 text-sm text-white focus:border-purple-500 focus:outline-none">
                    </div>
                </div>

                <div>
                    <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Message / Notes</label>
                    <textarea [(ngModel)]="editingLead.message" rows="3" class="w-full bg-black/30 border border-white/10 rounded p-2 text-sm text-white focus:border-purple-500 focus:outline-none resize-none"></textarea>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Status</label>
                        <select [(ngModel)]="editingLead.status" class="w-full bg-black/30 border border-white/10 rounded p-2 text-sm text-white focus:border-purple-500 focus:outline-none">
                            <option value="new">New</option>
                            <option value="contacted">Contacted</option>
                            <option value="qualified">Qualified</option>
                            <option value="proposal">Proposal</option>
                            <option value="won">Won</option>
                            <option value="lost">Lost</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">Source</label>
                        <input type="text" [(ngModel)]="editingLead.source" class="w-full bg-black/30 border border-white/10 rounded p-2 text-sm text-white focus:border-purple-500 focus:outline-none">
                    </div>
                </div>
            </div>

            <div class="mt-8 flex justify-end gap-3">
                <button (click)="closeModal()" class="px-4 py-2 text-gray-400 hover:text-white hover:bg-white/5 rounded text-sm font-medium transition">Cancel</button>
                <button (click)="saveLead()" class="px-6 py-2 bg-purple-600 text-white rounded font-bold text-sm hover:bg-purple-500 shadow-md transition">Save</button>
            </div>
        </div>
    </div>
  }
</div>