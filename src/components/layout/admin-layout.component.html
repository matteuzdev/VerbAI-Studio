<div class="flex h-screen bg-[#0B0C10] text-gray-300 font-sans relative overflow-hidden">
  
  <!-- Background Grid Effect -->
  <div class="absolute inset-0 z-0 pointer-events-none opacity-20"
       style="background-size: 40px 40px; background-image: linear-gradient(to right, rgba(255, 255, 255, 0.05) 1px, transparent 1px), linear-gradient(to bottom, rgba(255, 255, 255, 0.05) 1px, transparent 1px);">
  </div>

  <!-- VerbAI Assistant (Admin Only) -->
  <app-chat-widget></app-chat-widget>

  <!-- Sidebar -->
  <aside class="w-64 bg-[#0F1117] border-r border-white/5 flex flex-col z-10 shrink-0 shadow-xl">
    <div class="p-6 border-b border-white/5">
      <div class="flex items-center gap-2 text-white font-bold text-xl tracking-tight">
        <span class="material-symbols-outlined text-3xl text-purple-500">deployed_code</span>
        <span>VerbAI Studio</span>
      </div>
    </div>

    <div class="p-4">
      <label class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2 block">{{ store.dict().tenant }}</label>
      <select 
        (change)="switchTenant($event)"
        class="w-full bg-white/5 border border-white/10 rounded-lg p-2.5 text-sm focus:ring-purple-500 focus:border-purple-500 block text-gray-300 outline-none transition hover:bg-white/10">
        @for (tenant of store.tenants(); track tenant.id) {
          <option [value]="tenant.id" [selected]="tenant.id === store.selectedTenantId()" class="bg-[#1C1D24]">
            {{ tenant.name }}
          </option>
        }
      </select>
    </div>

    <nav class="flex-1 p-4 space-y-1 overflow-y-auto">
      @for (item of menuItems(); track item.path) {
        <a [routerLink]="item.path" 
           routerLinkActive="bg-purple-500/10 text-purple-400 border border-purple-500/20"
           [routerLinkActiveOptions]="{exact: true}"
           class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-gray-400 hover:bg-white/5 hover:text-white transition-all border border-transparent">
          <span class="material-symbols-outlined text-[20px]">{{ item.icon }}</span>
          {{ item.label }}
        </a>
      }
    </nav>
    
    <!-- System Status & Language -->
    <div class="px-6 py-4 border-t border-white/5 bg-[#0B0C10]/50 space-y-4">
      
      <!-- Status Indicator -->
      <div class="flex items-center justify-between text-xs">
         <span class="text-gray-500 font-medium tracking-wide uppercase">System Status</span>
         <div class="flex items-center gap-1.5" [title]="systemStatus().label">
            <span class="w-2 h-2 rounded-full shadow-[0_0_10px_currentColor]" [class]="systemStatus().color"></span>
            <span class="text-gray-400 font-semibold">{{ systemStatus().label }}</span>
         </div>
      </div>

      <!-- Language Selector -->
      <div class="flex justify-center gap-4">
        <button (click)="store.setLanguage('pt')" 
                [class.grayscale]="store.language() !== 'pt'"
                [class.opacity-50]="store.language() !== 'pt'"
                class="hover:grayscale-0 hover:opacity-100 hover:scale-110 transition-all duration-300" 
                title="Português">
          <img src="https://flagcdn.com/w40/br.png" alt="Brazil" class="w-5 h-5 rounded-full object-cover shadow-sm ring-1 ring-white/10">
        </button>
        
        <button (click)="store.setLanguage('en')" 
                [class.grayscale]="store.language() !== 'en'"
                [class.opacity-50]="store.language() !== 'en'"
                class="hover:grayscale-0 hover:opacity-100 hover:scale-110 transition-all duration-300" 
                title="English">
          <img src="https://flagcdn.com/w40/us.png" alt="USA" class="w-5 h-5 rounded-full object-cover shadow-sm ring-1 ring-white/10">
        </button>
        
        <button (click)="store.setLanguage('es')" 
                [class.grayscale]="store.language() !== 'es'"
                [class.opacity-50]="store.language() !== 'es'"
                class="hover:grayscale-0 hover:opacity-100 hover:scale-110 transition-all duration-300" 
                title="Español">
          <img src="https://flagcdn.com/w40/es.png" alt="Spain" class="w-5 h-5 rounded-full object-cover shadow-sm ring-1 ring-white/10">
        </button>
      </div>
    </div>

    <!-- User Profile Area -->
    <div (click)="openProfile()" class="p-4 border-t border-white/5 cursor-pointer hover:bg-white/5 transition group">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <!-- Avatar -->
          <div class="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center overflow-hidden border border-white/10">
             @if(store.currentUser()?.avatarUrl) {
                <img [src]="store.currentUser()?.avatarUrl" class="w-full h-full object-cover">
             } @else {
                <span class="text-xs font-bold text-gray-400">{{ store.currentUser()?.initials || 'G' }}</span>
             }
          </div>
          <div class="text-sm">
            <p class="font-medium text-gray-300 group-hover:text-white transition">{{ store.currentUser()?.name || 'Guest' }}</p>
            <p class="text-[10px] text-gray-500 capitalize">{{ store.currentUser()?.role || 'Visitor' }}</p>
          </div>
        </div>
        <button class="text-gray-600 group-hover:text-gray-400 transition">
          <span class="material-symbols-outlined text-[18px]">settings</span>
        </button>
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 overflow-auto flex flex-col relative z-10 scrollbar-thin scrollbar-thumb-white/10 scrollbar-track-transparent">
    <router-outlet></router-outlet>
  </main>

  <!-- USER PROFILE MODAL (Dark Mode) -->
  @if (isProfileOpen()) {
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-[fade-in_0.2s_ease-out]">
        <div class="bg-[#1C1D24] w-full max-w-2xl rounded-2xl shadow-2xl border border-white/10 overflow-hidden flex flex-col md:flex-row h-[500px]">
            
            <!-- Left: Navigation -->
            <div class="w-full md:w-64 bg-[#161821] border-r border-white/5 p-6 flex flex-col justify-between">
                <div>
                    <h2 class="text-xs font-bold text-gray-500 uppercase tracking-widest mb-6">{{ store.dict().prof_title }}</h2>
                    <nav class="space-y-2">
                        <button (click)="setTab('profile')" 
                            [class.bg-white/10]="activeTab() === 'profile'"
                            [class.text-white]="activeTab() === 'profile'"
                            class="w-full text-left px-4 py-2 rounded-lg text-sm font-medium text-gray-400 hover:bg-white/5 hover:text-white transition flex items-center gap-3">
                            <span class="material-symbols-outlined text-[18px]">person</span>
                            {{ store.dict().prof_tab_profile }}
                        </button>
                        <button (click)="setTab('security')" 
                            [class.bg-white/10]="activeTab() === 'security'"
                            [class.text-white]="activeTab() === 'security'"
                            class="w-full text-left px-4 py-2 rounded-lg text-sm font-medium text-gray-400 hover:bg-white/5 hover:text-white transition flex items-center gap-3">
                            <span class="material-symbols-outlined text-[18px]">lock</span>
                            {{ store.dict().prof_tab_security }}
                        </button>
                        <button (click)="setTab('team')" 
                            [class.bg-white/10]="activeTab() === 'team'"
                            [class.text-white]="activeTab() === 'team'"
                            class="w-full text-left px-4 py-2 rounded-lg text-sm font-medium text-gray-400 hover:bg-white/5 hover:text-white transition flex items-center gap-3">
                            <span class="material-symbols-outlined text-[18px]">group</span>
                            {{ store.dict().prof_tab_team }}
                        </button>
                    </nav>
                </div>
                <button (click)="logout()" class="flex items-center gap-2 text-red-400 hover:text-red-300 text-sm font-medium px-4 py-2 hover:bg-red-500/10 rounded transition">
                    <span class="material-symbols-outlined text-[18px]">logout</span>
                    {{ store.dict().prof_signout }}
                </button>
            </div>

            <!-- Right: Content -->
            <div class="flex-1 flex flex-col relative bg-[#1C1D24]">
                <button (click)="closeProfile()" class="absolute top-4 right-4 text-gray-500 hover:text-white transition">
                    <span class="material-symbols-outlined">close</span>
                </button>

                <div class="p-8 overflow-y-auto h-full text-gray-300">
                    
                    <!-- TAB: PROFILE -->
                    @if (activeTab() === 'profile') {
                        <h3 class="text-xl font-bold text-white mb-6">{{ store.dict().prof_tab_profile }}</h3>
                        
                        <div class="flex items-center gap-6 mb-8">
                            <div class="relative group w-20 h-20 rounded-full bg-white/5 overflow-hidden cursor-pointer border-2 border-transparent hover:border-purple-500 transition">
                                @if(store.currentUser()?.avatarUrl) {
                                    <img [src]="store.currentUser()?.avatarUrl" class="w-full h-full object-cover">
                                } @else {
                                    <div class="w-full h-full flex items-center justify-center text-xl font-bold text-gray-500">{{ store.currentUser()?.initials }}</div>
                                }
                                <div (click)="fileInput.click()" class="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition">
                                    <span class="material-symbols-outlined text-white">photo_camera</span>
                                </div>
                                <input #fileInput type="file" hidden accept="image/*" (change)="onAvatarSelected($event)">
                            </div>
                            <div>
                                <h4 class="font-bold text-white">{{ store.dict().prof_photo }}</h4>
                                <p class="text-xs text-gray-500">{{ store.dict().prof_photo_desc }}</p>
                            </div>
                        </div>

                        <div class="space-y-4 max-w-xs">
                            <div>
                                <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">{{ store.dict().prof_name }}</label>
                                <input type="text" [(ngModel)]="editName" class="w-full bg-black/30 border border-white/10 rounded p-2 text-sm text-white focus:border-purple-500 focus:outline-none focus:ring-1 focus:ring-purple-500">
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">{{ store.dict().prof_email }}</label>
                                <input type="text" [value]="store.currentUser()?.email" readonly class="w-full bg-white/5 border border-white/5 rounded p-2 text-sm text-gray-500 cursor-not-allowed">
                            </div>
                            <button (click)="saveProfile()" class="mt-4 px-4 py-2 bg-purple-600 text-white rounded font-medium text-sm hover:bg-purple-500 transition shadow-[0_0_15px_rgba(147,51,234,0.3)]">{{ store.dict().prof_save }}</button>
                        </div>
                    }

                    <!-- TAB: SECURITY -->
                    @if (activeTab() === 'security') {
                        <h3 class="text-xl font-bold text-white mb-6">{{ store.dict().prof_tab_security }}</h3>
                        <div class="space-y-4 max-w-xs">
                            <div>
                                <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">{{ store.dict().prof_curr_pass }}</label>
                                <input type="password" [(ngModel)]="oldPassword" class="w-full bg-black/30 border border-white/10 rounded p-2 text-sm text-white focus:border-purple-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">{{ store.dict().prof_new_pass }}</label>
                                <input type="password" [(ngModel)]="newPassword" class="w-full bg-black/30 border border-white/10 rounded p-2 text-sm text-white focus:border-purple-500 focus:outline-none">
                            </div>
                             <button (click)="savePassword()" class="mt-4 px-4 py-2 bg-white text-black rounded font-medium text-sm hover:bg-gray-200 transition">{{ store.dict().prof_update_pass }}</button>
                        </div>
                    }

                    <!-- TAB: TEAM -->
                    @if (activeTab() === 'team') {
                        <h3 class="text-xl font-bold text-white mb-6">{{ store.dict().prof_tab_team }}</h3>
                        
                        <div class="mb-6 p-4 bg-white/5 rounded-lg border border-white/10">
                             <h4 class="text-[10px] font-bold text-gray-500 uppercase mb-3">{{ store.dict().prof_invite_title }}</h4>
                             <div class="flex flex-col sm:flex-row gap-2">
                                 <input type="email" [(ngModel)]="newMemberEmail" placeholder="colleague@verbai.com" class="flex-1 bg-black/30 border border-white/10 rounded p-2 text-sm text-white focus:border-purple-500 focus:outline-none placeholder-gray-600">
                                 <select [(ngModel)]="newMemberRole" class="bg-black/30 border border-white/10 rounded p-2 text-sm text-white focus:border-purple-500 focus:outline-none">
                                     <option value="Admin">Admin</option>
                                     <option value="Editor">Editor</option>
                                     <option value="Viewer">Viewer</option>
                                 </select>
                                 <button (click)="inviteMember()" class="px-4 py-2 bg-purple-600 text-white rounded font-bold text-sm hover:bg-purple-500 transition shadow-[0_0_15px_rgba(147,51,234,0.3)]">{{ store.dict().prof_invite_btn }}</button>
                             </div>
                        </div>

                        <div class="space-y-2">
                            @for (member of store.teamMembers(); track member.email) {
                                <div class="flex items-center justify-between p-3 border-b border-white/5 last:border-0 hover:bg-white/5 rounded transition group">
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 rounded-full bg-purple-500/20 text-purple-400 flex items-center justify-center text-xs font-bold border border-purple-500/30">
                                            {{ member.email.charAt(0).toUpperCase() }}
                                        </div>
                                        <div>
                                            <p class="text-sm font-medium text-white">{{ member.email }}</p>
                                            <p class="text-[10px] text-gray-500">{{ member.role }} • {{ member.status }}</p>
                                        </div>
                                    </div>
                                    <button (click)="removeMember(member.email)" class="text-gray-500 hover:text-red-400 hover:bg-red-500/10 p-2 rounded-full transition" title="Remove Member">
                                        <span class="material-symbols-outlined text-[18px]">delete</span>
                                    </button>
                                </div>
                            }
                        </div>
                    }

                </div>
            </div>

        </div>
    </div>
  }
</div>